<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salesforce Developer Lab Hackathon: Knowledge Companion</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f4f7f9;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .slide-container {
            width: 90%;
            max-width: 1000px;
            margin: 20px auto;
            background-color: #fff;
            border: 1px solid #ddd;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .slide {
            display: none;
            padding: 30px 40px;
            min-height: 400px;
            animation: fadeIn 0.5s ease-in-out;
        }

        .slide.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        h1, h2, h3, h4 {
            color: #003972; /* Salesforce Blue */
            margin-bottom: 0.75em;
        }
        h1 { font-size: 2.2em; text-align: center; margin-bottom: 1em; color: #001B35; }
        h2 { font-size: 1.8em; border-bottom: 2px solid #00A1E0; padding-bottom: 0.3em; margin-top: 1.5em;}
        h3 { font-size: 1.4em; margin-top: 1.2em; }
        h4 { font-size: 1.1em; font-style: italic; color: #555;}


        p, ul, ol {
            margin-bottom: 1em;
        }

        ul, ol {
            padding-left: 20px;
        }
        li { margin-bottom: 0.5em; }

        code { /* For inline code */
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
            background-color: #eef1f3;
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-size: 0.9em;
        }

        pre { /* For code blocks */
            background-color: #2d2d2d; /* Dark background */
            color: #f8f8f2; /* Light text */
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto; /* Allow horizontal scrolling for long lines */
            font-size: 0.85em; /* Slightly smaller for blocks */
            line-height: 1.5;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            white-space: pre; /* Preserve whitespace and line breaks */
        }
        pre code { /* Reset styles for <code> inside <pre> */
            background-color: transparent;
            padding: 0;
            font-size: 1em; /* Inherit font-size from pre or set explicitly */
            color: inherit; /* Inherit color from pre */
            white-space: inherit; /* Inherit whitespace handling */
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            padding: 20px 40px;
            background-color: #f0f0f0;
            border-top: 1px solid #ccc;
            width: 90%;
            max-width: 1000px;
            box-sizing: border-box;
            margin: 0 auto 20px auto;
        }

        .navigation-buttons button {
            background-color: #0070d2;
            color: white;
            border: none;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .navigation-buttons button:hover:not(:disabled) {
            background-color: #005fb2;
        }

        .navigation-buttons button:disabled {
            background-color: #c0c0c0;
            cursor: not-allowed;
        }

        .note {
            background-color: #fff3cd;
            border-left: 5px solid #ffeeba;
            padding: 10px 15px;
            margin: 15px 0;
            border-radius: 3px;
        }
        .note strong { color: #856404; }

        .modal { /* LWC SLDS Modal styling is handled by Salesforce, this is a generic example if not using LWC base modal */
            display: none; position: fixed; z-index: 1000;
            left: 0; top: 0; width: 100%; height: 100%;
            overflow: auto; background-color: rgba(0,0,0,0.4);
        }
        .modal-content {
            background-color: #fefefe; margin: 15% auto; padding: 20px;
            border: 1px solid #888; width: 60%; border-radius: 8px;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
        }
        .modal-content h3 { margin-top: 0;}

        #workflowAnimation {
            width: 100%; height: 400px; border: 1px solid #eee;
            margin-top: 20px; background-color: #f9f9f9;
        }
        #workflowAnimation svg { display: block; width: 100%; height: 100%;}

        .summary-toggle-container {
            margin-top: 20px; padding: 15px; background-color: #e9ecef; border-radius: 5px;
        }
        .summary-toggle-container button { margin-bottom: 10px;}
        .summary-text-area {
            border: 1px dashed #ccc; padding: 10px; min-height: 100px; background-color: #fff;
        }
        #summaryAfterView { display: none; }

        /* Basic conceptual syntax highlighting tokens */
        .token.comment { color: #6a9955; font-style: italic; }
        .token.keyword { color: #569cd6; font-weight: bold; }
        .token.string { color: #ce9178; }
        .token.punctuation { color: #d4d4d4; } /* For general punctuation */
        .token.class-name { color: #4ec9b0; }
        .token.function { color: #dcdcaa; }
        .token.tag { color: #569cd6; } /* HTML/XML tags */
        .token.attr-name { color: #9cdcfe; } /* HTML/XML attribute names */
        .token.attr-value { color: #ce9178; } /* HTML/XML attribute values */
        .token.annotation { color: #4ec9b0; font-style: italic; } /* e.g. @AuraEnabled */
        .token.important-comment { color: #ff6347; font-weight: bold; } /* For standout comments */
    </style>
</head>
<body>

    <h1>üöÄ Salesforce Developer Lab: Knowledge Companion - Document Summariser üìÑ</h1>

    <div class="slide-container">
        <div class="slide active" id="slide1">
            <h2>Lab Overview & Business Impact</h2>
            <h3>The Challenge: Information Overload üò©</h3>
            <p>In today's fast-paced environment, users are often confronted with vast amounts of text. Quickly understanding the essence of long documents like Salesforce <strong>Knowledge Articles</strong>, detailed <strong>Case Descriptions</strong>, or comprehensive <strong>Product Manuals</strong> is crucial but time-consuming.</p>
            <h3>The Solution: Knowledge Companion ‚ú®</h3>
            <p>This lab guides you in building a "Knowledge Companion" tool. Powered by the <strong>Gemini API</strong> (using the Gemini Flash 1.5 model), this tool integrates directly into Salesforce to provide instant summaries of lengthy text content. This significantly enhances productivity by allowing users to grasp key information at a glance.</p>
            <h3>Real-Life Use Cases üí°</h3>
            <ul>
                <li><strong>Support Agents:</strong> Quickly summarize complex case histories or long knowledge articles to resolve issues faster.</li>
                <li><strong>Sales Teams:</strong> Get rapid summaries of account details, past communications, or opportunity notes.</li>
                <li><strong>Product Managers:</strong> Condense user feedback or technical documentation.</li>
                <li><strong>Any Salesforce User:</strong> Efficiently process information from lengthy text fields across various objects.</li>
            </ul>
        </div>

        <div class="slide" id="slide2">
            <h2>Lab Goal üéØ</h2>
            <p>By the end of this lab, you will have built a solution that can:</p>
            <ul>
                <li>Summarize content from a rich text area field (e.g., <code>Content_for_Summarization__c</code>) on a Salesforce Knowledge Article.</li>
                <li>Trigger this summarization process via a custom Lightning Web Component (LWC) button ("AI Summarise") placed on the Knowledge Article page.</li>
                <li>Display the AI-generated summary clearly within a modal dialog on the screen.</li>
            </ul>
            <p>This hands-on experience will cover Salesforce configuration, Apex development for API callouts, and LWC creation for a seamless user interface.</p>
        </div>

        <div class="slide" id="slide3">
            <h2>Step 1: Salesforce Org Setup ‚öôÔ∏è</h2>
            <p>First, let's prepare your Salesforce Developer Org.</p>
            <h3>1. Enable Salesforce Knowledge</h3>
            <ul>
                <li>Navigate to <strong>Setup</strong> &gt; <strong>Knowledge</strong> &gt; <strong>Knowledge Settings</strong>.</li>
                <li>If not already enabled, check "Yes, I'd like to enable Salesforce Knowledge" and follow the setup wizard. You might need to assign licenses and permissions to your user.</li>
            </ul>
            <h3>2. Add Custom Field to Knowledge Object</h3>
            <p>We need a field on the Knowledge Article object (API Name: <code>Knowledge__kav</code>) to hold the content you want to summarize. If you already have a rich text field with your main content, you can use that. Otherwise, create a new one:</p>
            <ul>
                <li>Navigate to <strong>Setup</strong> &gt; <strong>Object Manager</strong> &gt; <strong>Knowledge</strong>.</li>
                <li>Go to <strong>Fields & Relationships</strong> and click <strong>New</strong>.</li>
                <li>Select Data Type: <strong>Text Area (Rich)</strong> or <strong>Text Area (Long)</strong>. Click Next.</li>
                <li>Field Label: e.g., <code>Content for Summarization</code></li>
                <li>Field Name: e.g., <code>Content_for_Summarization__c</code>. (You will need this API name for the LWC later).</li>
                <li>Complete the field creation wizard (ensure it's visible to appropriate profiles and added to page layouts).</li>
            </ul>
            <div class="note">
                <strong>Important:</strong> Note down the API name of the field you intend to use for summarization (e.g., <code>Content_for_Summarization__c</code>, or a standard field like <code>Answer__c</code> if appropriate for your article type). You will need this for the LWC JavaScript.
            </div>
            <h3>3. API Access and User Permissions</h3>
            <ul>
                <li>Ensure your user profile has "API Enabled" system permission.</li>
                <li>Ensure your user has CRUD permissions on the Knowledge object and the custom field you're using.</li>
            </ul>
        </div>

        <div class="slide" id="slide4">
            <h2>Step 2: Gemini API Configuration üîë</h2>
            <p>Now, let's set up access to the Google Gemini API.</p>
            <h3>1. Get Your Gemini API Key</h3>
            <ul>
                <li>Go to <a href="https://makersuite.google.com/app/apikey" target="_blank">Google AI Studio</a>.</li>
                <li>Sign in with your Google account.</li>
                <li>Click on "Get API key" and then "Create API key in new project" (or use an existing one).</li>
                <li>Copy your API key. <strong>This key is sensitive! Store it securely and do not commit it directly into version control in real projects.</strong></li>
            </ul>
            <h3>2. Create a Named Credential in Salesforce</h3>
            <p>Named Credentials simplify authenticated callouts from Salesforce by separating the endpoint URL from the code.</p>
            <ul>
                <li>In Salesforce Setup, search for "Named Credentials".</li>
                <li>Click <strong>New Named Credential</strong>.
                    <ul>
                        <li><strong>Label:</strong> <code>Google_Gemini_API</code> (You can choose your own label)</li>
                        <li><strong>Name:</strong> <code>Google_Gemini_API</code> (Auto-filled from label, this is what you use in Apex: <code>callout:Google_Gemini_API</code>)</li>
                        <li><strong>URL:</strong> <code>https://generativelanguage.googleapis.com</code> (This is the base URL for the Gemini API)</li>
                        <li><strong>Identity Type:</strong> <code>Anonymous</code> (As we'll pass the API key in the header via Apex)</li>
                        <li><strong>Authentication Protocol:</strong> <code>No Authentication</code></li>
                        <li><strong>Generate Authorization Header:</strong> Unchecked</li>
                    </ul>
                </li>
                <li>Click <strong>Save</strong>.</li>
            </ul>
            <h3>3. Securely Storing and Accessing the API Key (POC vs. Production)</h3>
            <div class="note">
                <p>For this POC / Lab: We'll show how to place the API key in Apex with a clear placeholder. This is for ease of setup during the lab.</p>
                <p><strong>For Production (and better practice even for POCs):</strong></p>
                <ol>
                    <li>Store the API Key in a **Protected Custom Setting** or **Protected Custom Metadata Type**. This keeps it out of code.</li>
                    <li>Retrieve it in Apex: e.g., <code>My_API_Keys__c.getInstance('Gemini').API_Key__c;</code></li>
                </ol>
                <p>Hardcoding keys directly in Apex is a security risk in real-world applications.</p>
            </div>
        </div>

        <div class="slide" id="slide5">
            <h2>Step 3: Apex Code Walkthrough üë®‚Äçüíª</h2>
            <p>This Apex class (<code>GeminiAPIService.cls</code>) will make the callout to the Gemini API.</p>
            <p><strong>Action:</strong> Create this Apex class in your Salesforce org.</p>
            <pre>
                <code class="language-apex">
         
                </code>
            </pre>
            <p class="note"><strong>Remember to replace <code>'YOUR_ACTUAL_GEMINI_API_KEY'</code> in the Apex code with your valid Gemini API Key.</strong></p>
        </div>

        <div class="slide" id="slide6">
            <h2>Step 4: Lightning Web Component (LWC) ‚ö°</h2>
            <p>Create an LWC named <code>knowledgeCompanion</code>. It will consist of three files: HTML, JavaScript, and XML (metadata).</p>
            
            <h3>1. <code>knowledgeCompanion.html</code></h3>
            <p>This file defines the structure and appearance of your component.</p>
            <pre><code class="language-html">
// File: knowledgeCompanion.html
            </code></pre>
            <h3 style="margin-top: 2em;">2. <code>knowledgeCompanion.js</code></h3>
            <p>This file contains the component's JavaScript logic.</p>
            <pre><code class="language-javascript">
// File: knowledgeCompanion.js
            </code></pre>

            <h3 style="margin-top: 2em;">3. <code>knowledgeCompanion.js-meta.xml</code></h3>
            <p>This file defines the metadata for the LWC, like where it can be used.</p>
            <pre><code class="language-xml">

            </code></pre>
            <p class="note">After creating these three files in your Salesforce DX project or Developer Console, deploy them to your org. Then, you can add the `knowledgeCompanion` LWC to your Knowledge Article Lightning Record Pages using the Lightning App Builder.</p>
        </div>

        <div class="slide" id="slide7">
            <h2>Step 5: Simulation & Visuals üìä</h2>
            <h3>Workflow Animation</h3>
            <p>This animation visualizes the data flow when you click "AI Summarise". Click "Replay Animation" to restart it.</p>
            <div id="workflowAnimation"></div>
            <button onclick="startWorkflowAnimation()" class="slds-button slds-button_neutral slds-m-top_small">Replay Animation</button>

            <h3 class="slds-m-top_large">Before/After Summary View (Toggle Example)</h3>
            <div class="summary-toggle-container">
                <p>This is a static example to simulate how long text can be condensed. Click the button to toggle between the original content and its AI-generated summary.</p>
                <button id="toggleSummaryBtn" onclick="toggleSummaryView()" class="slds-button slds-button_brand">Show AI Summary Example</button>
                <div id="originalTextView" class="summary-text-area">
                    <h4>Original Document Text (Example)</h4>
                    <p>The Q4 Global Sales Initiative, codenamed "Project Everest," aims to expand market penetration in emerging APAC regions by 15% and increase overall recurring revenue by 10% through strategic partnerships and a revamped digital marketing strategy. Key performance indicators (KPIs) will include new customer acquisition rates, average deal size, and customer lifetime value. The initiative will involve cross-functional teams from Sales, Marketing, and Product Development, with a projected timeline of six months, starting January 1st. Bi-weekly progress reports will be submitted to the executive leadership team, outlining achievements, challenges, and mitigation strategies. A dedicated budget of $2.5 million has been allocated for this initiative, covering marketing campaigns, sales incentives, and technology upgrades. Training sessions for the sales team on new product features and market positioning are scheduled for mid-December. The success of Project Everest is critical for achieving the company's annual growth targets and strengthening its competitive position in the global market. All team members are expected to fully commit to their roles and responsibilities to ensure the project's objectives are met within the stipulated timeframe and budget.</p>
                </div>
                <div id="summaryAfterView" class="summary-text-area">
                    <h4>AI Generated Summary (Example)</h4>
                    <p>"Project Everest," a 6-month, $2.5M Q4 initiative, targets a 15% APAC market expansion and 10% recurring revenue growth via partnerships and digital marketing. KPIs include customer acquisition, deal size, and lifetime value. Cross-functional teams will report bi-weekly to executives. Success is vital for annual growth and market position.</p>
                </div>
            </div>
        </div>

        <div class="slide" id="slide8">
            <h2>Congratulations & Next Steps üéâ</h2>
            <h3>What You've Accomplished in this Lab üèÜ</h3>
            <ul>
                <li>Configured Salesforce and the Gemini API for integration.</li>
                <li>Developed an Apex class to make secure callouts to an external AI service.</li>
                <li>Built a Lightning Web Component (LWC) to provide a user interface on a record page.</li>
                <li>Implemented LWC-to-Apex communication to trigger the AI summarization.</li>
                <li>Displayed dynamic results from an API call within a modal in the LWC.</li>
                <li>Understood the basic principles of consuming generative AI for text summarization within Salesforce.</li>
            </ul>
            <h3>Potential Project Implementations & Enhancements üöÄ</h3>
            <ul>
                <li>Summarize Case descriptions, EmailMessage bodies, Account notes, or Chatter posts.</li>
                <li>Implement batch Apex to summarize multiple records asynchronously.</li>
                <li>Allow users to customize the summarization prompt sent to the Gemini API.</li>
                <li>Extend to other generative AI tasks: text generation, translation, sentiment analysis.</li>
                <li>Option to save the generated summary back to a field on the Salesforce record.</li>
                <li>Trigger summarization via Salesforce Flow or Process Builder (using invocable Apex).</li>
            </ul>
            <h3>Further Reading & Resources üìö</h3>
            <ul>
                <li><a href="https://ai.google.dev/docs/gemini_api_overview" target="_blank">Google Gemini API Documentation</a></li>
                <li><a href="https://developer.salesforce.com/docs/" target="_blank">Salesforce Developer Guide</a></li>
                <li><a href="https://developer.salesforce.com/docs/component-library/documentation/en/lwc" target="_blank">Lightning Web Components Dev Guide</a></li>
                <li>Trailhead: Search for "Apex Integration Services", "Lightning Web Components Basics", "Build Flows with Invocable Actions".</li>
            </ul>
            <p>Keep exploring, keep building, and happy coding!</p>
        </div>
    </div> <div class="navigation-buttons">
        <button id="prevBtn" onclick="changeSlide(-1)">‚ùÆ Previous</button>
        <button id="nextBtn" onclick="changeSlide(1)">Next ‚ùØ</button>
    </div>

    <script>
        // --- Slide Navigation Logic ---
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide');
        const totalSlides = slides.length;
        const prevButton = document.getElementById('prevBtn');
        const nextButton = document.getElementById('nextBtn');

        function showSlide(index) {
            if (index < 0 || index >= totalSlides) {
                console.error("Invalid slide index:", index);
                return;
            }
            slides.forEach((slideEl, i) => {
                slideEl.classList.remove('active');
                if (i === index) {
                    slideEl.classList.add('active');
                }
            });
            currentSlide = index;
            updateNavButtons();

            if (index === 6) { // Slide 7 (0-indexed for workflow animation)
                startWorkflowAnimation();
            }
        }

        function changeSlide(step) {
            let newSlideIndex = currentSlide + step;
            if (newSlideIndex >= 0 && newSlideIndex < totalSlides) {
                showSlide(newSlideIndex);
            }
        }
        
        function updateNavButtons() {
            if (prevButton) {
                prevButton.disabled = currentSlide === 0;
            }
            if (nextButton) {
                nextButton.disabled = currentSlide === totalSlides - 1;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            if (slides.length > 0) {
                showSlide(0);
            } else {
                console.error("No slides with class '.slide' found. Navigation will not work.");
                if(prevButton) prevButton.disabled = true;
                if(nextButton) nextButton.disabled = true;
            }
            const toggleBtn = document.getElementById('toggleSummaryBtn');
            const summaryView = document.getElementById('summaryAfterView');
            if (toggleBtn && summaryView) {
                 if (summaryView.style.display === 'none' || summaryView.style.display === '') {
                    toggleBtn.textContent = 'Show AI Summary Example';
                } else {
                    toggleBtn.textContent = 'Show Original Text';
                }
            }
            basicSyntaxHighlight(); // Apply syntax highlighting after DOM is ready
        });

        // --- Slide 7: D3.js Workflow Animation ---
        function startWorkflowAnimation() {
            const svgContainer = d3.select("#workflowAnimation");
            svgContainer.selectAll("*").remove(); 

            const bounds = svgContainer.node().getBoundingClientRect();
            const width = bounds.width;
            const height = bounds.height;

            if (width <= 0 || height <= 0) {
                console.warn("D3 container has no dimensions. Skipping animation.");
                return;
            }
            
            const svg = svgContainer.append("svg")
                .attr("width", width)
                .attr("height", height)
                .attr("viewBox", `0 0 ${width} ${height}`)
                .style("overflow", "visible");

            const nodeRadius = Math.min(width, height) * 0.05;
            const fontSize = Math.min(width, height) * 0.025;

            const nodes = [
                { id: 1, name: "User Clicks Summarise", x: width * 0.2, y: height * 0.3 },
                { id: 2, name: "Apex Callout", x: width * 0.4, y: height * 0.3 },
                { id: 3, name: "SF Sends Request", x: width * 0.5, y: height * 0.15 },
                { id: 4, name: "Gemini API Processes", x: width * 0.7, y: height * 0.15 },
                { id: 5, name: "Gemini Responds", x: width * 0.5, y: height * 0.85 },
                { id: 6, name: "Apex Receives", x: width * 0.4, y: height * 0.7 },
                { id: 7, name: "Summary Displayed", x: width * 0.2, y: height * 0.7 }
            ];

            const links = [
                { source: nodes[0], target: nodes[1], label: "1. UI Event" },
                { source: nodes[1], target: nodes[2], label: "2. To SF Server" },
                { source: nodes[2], target: nodes[3], label: "3. To Gemini" },
                { source: nodes[3], target: nodes[4], label: "4. AI Response" },
                { source: nodes[4], target: nodes[5], label: "5. Back to SF" },
                { source: nodes[5], target: nodes[6], label: "6. Update UI" }
            ];
            
            svg.append("defs").append("marker")
                .attr("id", "arrow")
                .attr("viewBox", "0 -5 10 10")
                .attr("refX", nodeRadius * 0.7 + 5) 
                .attr("refY", 0)
                .attr("markerWidth", 6)
                .attr("markerHeight", 6)
                .attr("orient", "auto-start-reverse")
              .append("path")
                .attr("d", "M0,-5L10,0L0,5")
                .style("fill", "#555");

            const nodeElements = svg.selectAll("g.node")
                .data(nodes)
                .enter().append("g")
                .attr("class", "node")
                .attr("transform", d => `translate(${d.x},${d.y})`);

            nodeElements.append("circle")
                .attr("r", nodeRadius)
                .style("fill", "#00A1E0")
                .style("stroke", "#0070D2")
                .style("stroke-width", 2);

            nodeElements.append("text")
                .text(d => d.name)
                .attr("x", 0) 
                .attr("y", nodeRadius + fontSize * 1.2) 
                .style("font-size", `${fontSize}px`)
                .style("fill", "#333")
                .style("text-anchor", "middle");

            let animationDelay = 0;
            const stepDuration = 1000; 
            const highlightDuration = 500;

            links.forEach((link, i) => {
                const path = svg.append("line")
                    .attr("x1", link.source.x).attr("y1", link.source.y)
                    .attr("x2", link.source.x).attr("y2", link.source.y)
                    .attr("stroke", "#aaa").attr("stroke-width", 2)
                    .attr("marker-end", "url(#arrow)");
                
                const label = svg.append("text")
                    .text(link.label)
                    .attr("x", (link.source.x + link.target.x) / 2)
                    .attr("y", (link.source.y + link.target.y) / 2 - 5)
                    .style("font-size", `${fontSize * 0.8}px`).style("fill", "#555")
                    .style("text-anchor", "middle").style("opacity", 0);

                d3.select(nodeElements.nodes()[i]).select("circle").transition()
                    .delay(animationDelay).duration(highlightDuration).style("fill", "orange");
                animationDelay += highlightDuration;

                path.transition().delay(animationDelay).duration(stepDuration)
                    .attr("x2", link.target.x).attr("y2", link.target.y);

                label.transition().delay(animationDelay + stepDuration / 2).duration(highlightDuration)
                    .style("opacity", 1);
                animationDelay += stepDuration;

                d3.select(nodeElements.nodes()[i]).select("circle").transition()
                    .delay(animationDelay).duration(highlightDuration).style("fill", "#5cb85c");
            });
            
            if (nodes.length > 0 && nodeElements.nodes()[nodes.length-1]) { // Check if the last node exists
                 d3.select(nodeElements.nodes()[nodes.length-1]).select("circle").transition()
                    .delay(animationDelay).duration(highlightDuration).style("fill", "#5cb85c");
            }
        }
        
        function toggleSummaryView() {
            const originalView = document.getElementById('originalTextView');
            const summaryView = document.getElementById('summaryAfterView');
            const button = document.getElementById('toggleSummaryBtn');

            if (summaryView && originalView && button) {
                if (summaryView.style.display === 'none' || summaryView.style.display === '') {
                    originalView.style.display = 'none';
                    summaryView.style.display = 'block';
                    button.textContent = 'Show Original Text';
                } else {
                    originalView.style.display = 'block';
                    summaryView.style.display = 'none';
                    button.textContent = 'Show AI Summary Example';
                }
            }
        }

        function basicSyntaxHighlight() {
            document.querySelectorAll('pre code').forEach(block => {
                let textContent = block.textContent || ""; // Get raw text content
                let html = textContent; // Start with text content to avoid re-processing HTML entities multiple times
                
                // Apply syntax highlighting using regex. Order can be important.
                // Comments (block and line)
                html = html.replace(/(\/\*[\s\S]*?\*\/|\/\/.*)/g, '<span class="token comment">$&</span>');
                
                // Strings (single and double quotes, careful with escaped quotes within strings)
                html = html.replace(/(['"])(.*?)(?<!\\)\1/g, '$1<span class="token string">$2</span>$1');
                
                // Keywords (Apex & JS)
                const keywords = [
                    'public', 'private', 'static', 'void', 'String', 'Id', 'Map', 'List', 'if', 'else', 'for', 'while', 
                    'try', 'catch', 'finally', 'return', 'new', 'with sharing', 'class', 'extends', 'implements', 
                    'integer', 'boolean', 'true', 'false', 'null', 'this', 'super', 
                    '@AuraEnabled', '@api', '@wire', '@track', '@TestVisible', '@future', 
                    '@InvocableMethod', '@InvocableVariable', '@IsTest',
                    'import', 'export', 'default', 'const', 'let', 'var', 'async', 'await', 
                    'function', 'constructor', 'get', 'set', '=>', 'yield', 'from', 'of', 'undefined'
                ];
                const keywordRegex = new RegExp('\\b(' + keywords.join('|') + ')\\b', 'g');
                html = html.replace(keywordRegex, '<span class="token keyword">$1</span>');
                
                // Annotations (like @AuraEnabled, ensuring it doesn't re-wrap if already a keyword)
                // This needs to be less greedy than the keyword regex or handled carefully.
                // For simplicity, we rely on the keyword regex handling parts of annotations.
                // A more robust parser would be needed for perfect nested highlighting.
                // html = html.replace(/(@[A-Za-z_][A-Za-z0-9_]*(?:\s*\([\s\S]*?\))?)/g, '<span class="token annotation">$&</span>');
                
                // HTML/XML tags and attributes (only for blocks marked with language-html or language-xml)
                if (block.classList.contains('language-html') || block.classList.contains('language-xml')) {
                    // Basic Tag matching: <tagName ... > or </tagName>
                    html = html.replace(/(&lt;\/?\s*)([a-zA-Z0-9_:-]+)/g, '$1<span class="token tag">$2</span>');
                    // Basic Attribute matching: attrName="attrValue"
                    html = html.replace(/([a-zA-Z0-9_:-]+)=(".*?"|'.*?')/g, '<span class="token attr-name">$1</span>=<span class="token attr-value">$2</span>');
                }
                block.innerHTML = html;
            });
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salesforce Developer Lab Hackathon: Knowledge Companion</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f4f7f9;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .slide-container {
            width: 90%;
            max-width: 1000px;
            margin: 20px auto;
            background-color: #fff;
            border: 1px solid #ddd;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .slide {
            display: none;
            padding: 30px 40px;
            min-height: 400px;
            animation: fadeIn 0.5s ease-in-out;
        }

        .slide.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        h1, h2, h3, h4 {
            color: #003972; /* Salesforce Blue */
            margin-bottom: 0.75em;
        }
        h1 { font-size: 2.2em; text-align: center; margin-bottom: 1em; color: #001B35; }
        h2 { font-size: 1.8em; border-bottom: 2px solid #00A1E0; padding-bottom: 0.3em; margin-top: 1.5em;}
        h3 { font-size: 1.4em; margin-top: 1.2em; }
        h4 { font-size: 1.1em; font-style: italic; color: #555;}


        p, ul, ol {
            margin-bottom: 1em;
        }

        ul, ol {
            padding-left: 20px;
        }
        li { margin-bottom: 0.5em; }

        code {
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
            background-color: #eef1f3;
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-size: 0.9em;
        }

        pre {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 0.9em;
            line-height: 1.5;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        pre code {
            background-color: transparent;
            padding: 0;
            font-size: 1em;
            color: inherit;
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            padding: 20px 40px;
            background-color: #f0f0f0;
            border-top: 1px solid #ccc;
            width: 90%;
            max-width: 1000px;
            box-sizing: border-box;
            margin: 0 auto 20px auto; /* Top margin 0 for alignment with container, bottom margin for spacing */
        }

        .navigation-buttons button {
            background-color: #0070d2;
            color: white;
            border: none;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .navigation-buttons button:hover:not(:disabled) {
            background-color: #005fb2;
        }

        .navigation-buttons button:disabled {
            background-color: #c0c0c0;
            cursor: not-allowed;
        }

        .note {
            background-color: #fff3cd;
            border-left: 5px solid #ffeeba;
            padding: 10px 15px;
            margin: 15px 0;
            border-radius: 3px;
        }
        .note strong { color: #856404; }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 60%;
            border-radius: 8px;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
        }
        .modal-content h3 { margin-top: 0;}

        .close-button { /* This class is not used in current LWC modal, but good for general modal pattern */
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        #workflowAnimation {
            width: 100%;
            height: 400px;
            border: 1px solid #eee;
            margin-top: 20px;
            background-color: #f9f9f9;
        }
        #workflowAnimation svg {
            display: block;
            width: 100%;
            height: 100%;
        }

        .summary-toggle-container {
            margin-top: 20px;
            padding: 15px;
            background-color: #e9ecef;
            border-radius: 5px;
        }
        .summary-toggle-container button { margin-bottom: 10px;}
        .summary-text-area {
            border: 1px dashed #ccc;
            padding: 10px;
            min-height: 100px;
            background-color: #fff;
        }
        #summaryAfterView { display: none; }

        /* Basic conceptual syntax highlighting */
        .token.keyword { color: #569cd6; font-weight: bold; }
        .token.string { color: #ce9178; }
        .token.comment { color: #6a9955; font-style: italic; }
        .token.punctuation { color: #d4d4d4; }
        .token.class-name { color: #4ec9b0; }
        .token.function { color: #dcdcaa; }
        .token.tag { color: #569cd6; }
        .token.attr-name { color: #9cdcfe; }
        .token.attr-value { color: #ce9178; }
        .token.annotation { color: #4ec9b0; }
    </style>
</head>
<body>

    <h1>üöÄ Salesforce Developer Lab: Knowledge Companion - Document Summariser üìÑ</h1>

    <div class="slide-container">
        <div class="slide active" id="slide1">
            <h2>Lab Overview & Business Impact</h2>
            <h3>The Challenge: Information Overload üò©</h3>
            <p>In today's fast-paced environment, users are often confronted with vast amounts of text. Quickly understanding the essence of long documents like Salesforce <strong>Knowledge Articles</strong>, detailed <strong>Case Descriptions</strong>, or comprehensive <strong>Product Manuals</strong> is crucial but time-consuming.</p>
            <h3>The Solution: Knowledge Companion ‚ú®</h3>
            <p>This lab guides you in building a "Knowledge Companion" tool. Powered by the <strong>Gemini API</strong> (using the Gemini Flash 1.5 model), this tool integrates directly into Salesforce to provide instant summaries of lengthy text content. This significantly enhances productivity by allowing users to grasp key information at a glance.</p>
            <h3>Real-Life Use Cases üí°</h3>
            <ul>
                <li><strong>Support Agents:</strong> Quickly summarize complex case histories or long knowledge articles to resolve issues faster.</li>
                <li><strong>Sales Teams:</strong> Get rapid summaries of account details, past communications, or opportunity notes.</li>
                <li><strong>Product Managers:</strong> Condense user feedback or technical documentation.</li>
                <li><strong>Any Salesforce User:</strong> Efficiently process information from lengthy text fields across various objects.</li>
            </ul>
        </div>

        <div class="slide" id="slide2">
            <h2>Lab Goal üéØ</h2>
            <p>By the end of this lab, you will have built a solution that can:</p>
            <ul>
                <li>Summarize content from a rich text area field (e.g., <code>Content__c</code>) on a Salesforce Knowledge Article.</li>
                <li>Trigger this summarization process via a custom Lightning Web Component (LWC) button ("AI Summarise") placed on the Knowledge Article page.</li>
                <li>Display the AI-generated summary clearly within a modal dialog on the screen.</li>
            </ul>
            <p>This hands-on experience will cover Salesforce configuration, Apex development for API callouts, and LWC creation for a seamless user interface.</p>
        </div>

        <div class="slide" id="slide3">
            <h2>Step 1: Salesforce Org Setup ‚öôÔ∏è</h2>
            <p>First, let's prepare your Salesforce Developer Org.</p>
            <h3>1. Enable Salesforce Knowledge</h3>
            <ul>
                <li>Navigate to <strong>Setup</strong> &gt; <strong>Knowledge</strong> &gt; <strong>Knowledge Settings</strong>.</li>
                <li>If not already enabled, check "Yes, I'd like to enable Salesforce Knowledge" and follow the setup wizard. You might need to assign licenses and permissions to your user.</li>
            </ul>
            <h3>2. Add Custom Field to Knowledge Object</h3>
            <p>We need a field on the Knowledge Article object (<code>Knowledge__kav</code>) to hold the content you want to summarize. If you already have a rich text field with your main content, you can use that. Otherwise, create a new one:</p>
            <ul>
                <li>Navigate to <strong>Setup</strong> &gt; <strong>Object Manager</strong> &gt; <strong>Knowledge</strong>.</li>
                <li>Go to <strong>Fields & Relationships</strong> and click <strong>New</strong>.</li>
                <li>Select Data Type: <strong>Text Area (Rich)</strong> or <strong>Text Area (Long)</strong>. Click Next.</li>
                <li>Field Label: e.g., <code>Content for Summarization</code></li>
                <li>Field Name: e.g., <code>Content_for_Summarization__c</code>.</li>
                <li>Complete the field creation wizard (visible to appropriate profiles, add to page layouts).</li>
            </ul>
            <div class="note">
                <strong>Note:</strong> The standard Knowledge object has fields like `Answer__c` (for Q&A) or you might use a custom rich text field that's part of your article type. Identify the API name of the field containing the main text you wish to summarize for the LWC.
            </div>
            <h3>3. API Access and User Permissions</h3>
            <ul>
                <li>Ensure your user profile has "API Enabled" system permission.</li>
                <li>Ensure your user has CRUD permissions on the Knowledge object and the custom field.</li>
            </ul>
        </div>

        <div class="slide" id="slide4">
            <h2>Step 2: Gemini API Configuration üîë</h2>
            <p>Now, let's set up access to the Google Gemini API.</p>
            <h3>1. Get Your Gemini API Key</h3>
            <ul>
                <li>Go to <a href="https://makersuite.google.com/app/apikey" target="_blank">Google AI Studio</a>.</li>
                <li>Sign in with your Google account.</li>
                <li>Click on "Get API key" and then "Create API key in new project" (or use an existing one).</li>
                <li>Copy your API key and store it securely. <strong>This key is sensitive!</strong></li>
            </ul>
            <h3>2. Create a Named Credential in Salesforce</h3>
            <p>Named Credentials simplify authenticated callouts from Salesforce.</p>
            <ul>
                <li>In Salesforce Setup, search for "Named Credentials".</li>
                <li>Click <strong>New Named Credential</strong>.
                    <ul>
                        <li><strong>Label:</strong> <code>Google Gemini API</code></li>
                        <li><strong>Name:</strong> <code>Google_Gemini_API</code></li>
                        <li><strong>URL:</strong> <code>https://generativelanguage.googleapis.com</code></li>
                        <li><strong>Identity Type:</strong> <code>Anonymous</code></li>
                        <li><strong>Authentication Protocol:</strong> <code>No Authentication</code></li>
                        <li><strong>Generate Authorization Header:</strong> Unchecked</li>
                    </ul>
                </li>
                <li>Click <strong>Save</strong>.</li>
            </ul>
            <h3>3. Securely Storing and Accessing the API Key (Important Note)</h3>
            <div class="note">
                <p>For this hackathon lab, you might be tempted to hardcode the API key in your Apex class. <strong>Avoid this in real projects!</strong></p>
                <p><strong>Better approach for this lab (and closer to best practice):</strong></p>
                <ol>
                    <li>Create a Custom Setting: Setup &gt; Custom Settings &gt; New. Label: `Gemini API Config`, Object Name: `Gemini_API_Config`. Setting Type: `Hierarchy`. Add a new custom field: Data Type: `Text`, Field Label: `API Key`, Field Name: `API_Key__c`.</li>
                    <li>Manage the Custom Setting records and input your API key there.</li>
                    <li>In your Apex code, retrieve it: <code>Gemini_API_Config__c.getOrgDefaults().API_Key__c;</code></li>
                </ol>
                <p>For production, consider Protected Custom Settings/Metadata or external secrets management.</p>
            </div>
        </div>

        <div class="slide" id="slide5">
            <h2>Step 3: Apex Code Walkthrough üë®‚Äçüíª</h2>
            <p>Let's create an Apex class to communicate with the Gemini API.</p>
            <h3>1. Create Apex Class: <code>GeminiAPIService.cls</code></h3>
            <pre><code class="language-apex">
// GeminiAPIService.cls
public with sharing class GeminiAPIService {

    private static String getApiKey() {
        // OPTION 1: Using a Hierarchy Custom Setting (Recommended)
        /*
        Gemini_API_Config__c config = Gemini_API_Config__c.getOrgDefaults();
        if (config != null && String.isNotBlank(config.API_Key__c)) {
            return config.API_Key__c;
        }
        System.debug(LoggingLevel.ERROR, 'API Key not found in Custom Setting.');
        return null;
        */

        // OPTION 2: Placeholder for direct input (FOR LAB TESTING ONLY - REPLACE THIS)
        String apiKey = 'YOUR_GEMINI_API_KEY_HERE';
        if (apiKey == 'YOUR_GEMINI_API_KEY_HERE' || String.isBlank(apiKey)) {
            System.debug(LoggingLevel.ERROR, 'API Key is a placeholder or blank. Please configure it.');
        }
        return apiKey;
    }

    @AuraEnabled(cacheable=false)
    public static String getSummary(Id recordId, String textToSummarize) {
        if (String.isBlank(textToSummarize)) {
            return 'Error: No content provided for summarization.';
        }

        String apiKey = getApiKey();
        if (String.isBlank(apiKey) || apiKey == 'YOUR_GEMINI_API_KEY_HERE') {
            return 'Error: API Key not configured properly.';
        }

        HttpRequest request = new HttpRequest();
        request.setEndpoint('callout:Google_Gemini_API/v1beta/models/gemini-1.5-flash:generateContent');
        request.setMethod('POST');
        request.setHeader('Content-Type', 'application/json; charset=utf-8');
        request.setHeader('x-goog-api-key', apiKey);

        Map&lt;String, Object&gt; contentPart = new Map&lt;String, Object&gt;{'text' => textToSummarize};
        Map&lt;String, Object&gt; contentsMap = new Map&lt;String, Object&gt;{'parts' => new List&lt;Object&gt;{contentPart}};
        Map&lt;String, Object&gt; requestBodyMap = new Map&lt;String, Object&gt;{'contents' => new List&lt;Object&gt;{contentsMap}};
        
        request.setBody(JSON.serialize(requestBodyMap));
        request.setTimeout(60000);

        Http http = new Http();
        String summary = '';

        try {
            HttpResponse response = http.send(request);
            System.debug('Gemini API Status Code: ' + response.getStatusCode());

            if (response.getStatusCode() == 200) {
                Map&lt;String, Object&gt; result = (Map&lt;String, Object&gt;) JSON.deserializeUntyped(response.getBody());
                List&lt;Object&gt; candidates = (List&lt;Object&gt;) result.get('candidates');
                if (candidates != null && !candidates.isEmpty()) {
                    Map&lt;String, Object&gt; firstCandidate = (Map&lt;String, Object&gt;) candidates[0];
                    Map&lt;String, Object&gt; content = (Map&lt;String, Object&gt;) firstCandidate.get('content');
                    if (content != null) {
                        List&lt;Object&gt; parts = (List&lt;Object&gt;) content.get('parts');
                        if (parts != null && !parts.isEmpty()) {
                            Map&lt;String, Object&gt; firstPart = (Map&lt;String, Object&gt;) parts[0];
                            summary = (String) firstPart.get('text');
                        } else { summary = 'Error: No summary parts in response.'; }
                    } else { summary = 'Error: No content in candidate.'; }
                } else {
                    summary = 'Error: No candidates in API response.';
                    if (result.containsKey('error')) {
                       Map&lt;String, Object&gt; errorDetails = (Map&lt;String, Object&gt;)result.get('error');
                       summary += ' Details: ' + errorDetails.get('message');
                    }
                }
            } else {
                summary = 'Error: API call failed (' + response.getStatusCode() + '): ' + response.getBody();
            }
        } catch (Exception e) {
            summary = 'Error: Exception during API call - ' + e.getMessage();
            System.debug(LoggingLevel.ERROR, 'GeminiAPIService Exception: ' + e.getMessage() + '\\n' + e.getStackTraceString());
        }
        return summary != null ? summary.stripHtmlTags() : 'Error: Null summary.';
    }
}
            </code></pre>
        </div>

        <div class="slide" id="slide6">
            <h2>Step 4: Lightning Web Component (LWC) ‚ö°</h2>
            <p>Create an LWC named <code>knowledgeCompanion</code>.</p>
            <h3>1. <code>knowledgeCompanion.html</code></h3>
            <pre><code class="language-html">
&lt;template&gt;
    &lt;lightning-card title="Knowledge Companion: AI Summariser" icon-name="utility:summarydetail"&gt;
        &lt;div class="slds-p-around_medium"&gt;
            &lt;lightning-button
                label="AI Summarise Content"
                variant="brand"
                onclick={handleSummariseClick}
                disabled={isLoading}
                icon-name="utility:magicwand"&gt;
            &lt;/lightning-button&gt;
            &lt;template if:true={isLoading}&gt;
                &lt;div class="slds-m-top_medium slds-is-relative" style="height: 50px;"&gt;
                    &lt;lightning-spinner alternative-text="Loading..." size="medium"&gt;&lt;/lightning-spinner&gt;
                &lt;/div&gt;
            &lt;/template&gt;
            &lt;template if:true={error}&gt;
                &lt;div class="slds-m-top_medium slds-text-color_error"&gt;
                    &lt;p&gt;&lt;strong&gt;Error:&lt;/strong&gt; {error}&lt;/p&gt;
                &lt;/div&gt;
            &lt;/template&gt;
        &lt;/div&gt;
    &lt;/lightning-card&gt;

    &lt;template if:true={isModalOpen}&gt;
        &lt;section role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="modal-heading-01" class="slds-modal slds-fade-in-open"&gt;
            &lt;div class="slds-modal__container"&gt;
                &lt;header class="slds-modal__header"&gt;
                    &lt;button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeModal}&gt;
                        &lt;lightning-icon icon-name="utility:close" alternative-text="Close" variant="inverse" size="small"&gt;&lt;/lightning-icon&gt;
                        &lt;span class="slds-assistive-text"&gt;Close&lt;/span&gt;
                    &lt;/button&gt;
                    &lt;h2 id="modal-heading-01" class="slds-modal__title slds-hyphenate"&gt;AI Generated Summary&lt;/h2&gt;
                &lt;/header&gt;
                &lt;div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1"&gt;
                    &lt;p style="white-space: pre-wrap;"&gt;{summaryText}&lt;/p&gt;
                &lt;/div&gt;
                &lt;footer class="slds-modal__footer"&gt;
                    &lt;lightning-button label="Close" title="Close" onclick={closeModal}&gt;&lt;/lightning-button&gt;
                &lt;/footer&gt;
            &lt;/div&gt;
        &lt;/section&gt;
        &lt;div class="slds-backdrop slds-backdrop_open" role="presentation"&gt;&lt;/div&gt;
    &lt;/template&gt;
&lt;/template&gt;
            </code></pre>
            <h3>2. <code>knowledgeCompanion.js</code></h3>
            <pre><code class="language-javascript">
import { LightningElement, api, wire, track } from 'lwc';
import { getRecord, getFieldValue } from 'lightning/uiRecordApi';
import getSummary from '@salesforce/apex/GeminiAPIService.getSummary';

// IMPORTANT: Update this to your actual field API name on Knowledge__kav
import KNOWLEDGE_CONTENT_FIELD from '@salesforce/schema/Knowledge__kav.Content_for_Summarization__c';

export default class KnowledgeCompanion extends LightningElement {
    @api recordId;
    @track summaryText = '';
    @track isLoading = false;
    @track error;
    @track isModalOpen = false;
    _wiredArticleData;

    @wire(getRecord, { recordId: '$recordId', fields: [KNOWLEDGE_CONTENT_FIELD] })
    wiredArticle({ error, data }) {
        if (data) {
            this._wiredArticleData = data;
            this.error = undefined;
        } else if (error) {
            console.error('Error wiring article data:', JSON.stringify(error));
            this.error = 'Failed to load article content. Check field API name and permissions.';
            this._wiredArticleData = undefined;
        }
    }

    get articleContent() {
        return this._wiredArticleData ? getFieldValue(this._wiredArticleData, KNOWLEDGE_CONTENT_FIELD) : undefined;
    }

    async handleSummariseClick() {
        this.isLoading = true;
        this.error = undefined;
        this.summaryText = '';
        const contentToSummarize = this.articleContent;

        if (!contentToSummarize || String(contentToSummarize).trim() === '') {
            this.error = \`No content in field: \${KNOWLEDGE_CONTENT_FIELD.fieldApiName}\`;
            this.isLoading = false;
            return;
        }
        
        let plainTextContent = this.stripHtml(String(contentToSummarize));
        if (!plainTextContent || plainTextContent.trim() === '') {
            this.error = 'Content empty after HTML stripping.';
            this.isLoading = false;
            return;
        }

        try {
            const result = await getSummary({ recordId: this.recordId, textToSummarize: plainTextContent });
            if (result) {
                if (result.toLowerCase().startsWith('error:')) {
                    this.error = result;
                } else {
                    this.summaryText = result;
                    this.isModalOpen = true;
                }
            } else {
                this.error = 'Empty response from summarization service.';
            }
        } catch (e) {
            console.error('Apex call error:', JSON.stringify(e));
            this.error = (e.body?.message) || e.message || 'Unknown error during summarization.';
        } finally {
            this.isLoading = false;
        }
    }
    
    stripHtml(html) {
        if (!html) return "";
        try {
            let doc = new DOMParser().parseFromString(html, 'text/html');
            return doc.body.textContent || "";
        } catch (e) { // Fallback for environments where DOMParser might not be ideal or available
            return html.replace(/<[^>]*>?/gm, '');
        }
    }

    closeModal() {
        this.isModalOpen = false;
        this.summaryText = '';
    }
}
            </code></pre>
            <h3>3. <code>knowledgeCompanion.js-meta.xml</code></h3>
            <pre><code class="language-xml">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;LightningComponentBundle xmlns="http://soap.sforce.com/2006/04/metadata"&gt;
    &lt;apiVersion&gt;59.0&lt;/apiVersion&gt;
    &lt;isExposed&gt;true&lt;/isExposed&gt;
    &lt;targets&gt;
        &lt;target&gt;lightning__RecordPage&lt;/target&gt;
    &lt;/targets&gt;
    &lt;targetConfigs&gt;
        &lt;targetConfig targets="lightning__RecordPage"&gt;
            &lt;objects&gt;
                &lt;object&gt;Knowledge__kav&lt;/object&gt;
            &lt;/objects&gt;
        &lt;/targetConfig&gt;
    &lt;/targetConfigs&gt;
&lt;/LightningComponentBundle&gt;
            </code></pre>
        </div>

        <div class="slide" id="slide7">
            <h2>Step 5: Simulation & Visuals üìä</h2>
            <h3>Workflow Animation</h3>
            <p>This D3.js animation visualizes the data flow. Click "Replay Animation" to restart it.</p>
            <div id="workflowAnimation"></div>
            <button onclick="startWorkflowAnimation()" class="slds-button slds-button_neutral slds-m-top_small">Replay Animation</button>

            <h3 class="slds-m-top_large">Before/After Summary View (Toggle)</h3>
            <div class="summary-toggle-container">
                <p>Simulate how long text can be condensed. Toggle between original and summary.</p>
                <button id="toggleSummaryBtn" onclick="toggleSummaryView()" class="slds-button slds-button_brand">Show AI Summary Example</button>
                <div id="originalTextView" class="summary-text-area">
                    <h4>Original Document Text (Example)</h4>
                    <p>The Q4 Global Sales Initiative, codenamed "Project Everest," aims to expand market penetration in emerging APAC regions by 15% and increase overall recurring revenue by 10% through strategic partnerships and a revamped digital marketing strategy. Key performance indicators (KPIs) will include new customer acquisition rates, average deal size, and customer lifetime value. The initiative will involve cross-functional teams from Sales, Marketing, and Product Development, with a projected timeline of six months, starting January 1st. Bi-weekly progress reports will be submitted to the executive leadership team, outlining achievements, challenges, and mitigation strategies. A dedicated budget of $2.5 million has been allocated for this initiative, covering marketing campaigns, sales incentives, and technology upgrades. Training sessions for the sales team on new product features and market positioning are scheduled for mid-December. The success of Project Everest is critical for achieving the company's annual growth targets and strengthening its competitive position in the global market. All team members are expected to fully commit to their roles and responsibilities to ensure the project's objectives are met within the stipulated timeframe and budget.</p>
                </div>
                <div id="summaryAfterView" class="summary-text-area">
                    <h4>AI Generated Summary (Example)</h4>
                    <p>"Project Everest," a 6-month, $2.5M Q4 initiative, targets a 15% APAC market expansion and 10% recurring revenue growth via partnerships and digital marketing. KPIs include customer acquisition, deal size, and lifetime value. Cross-functional teams will report bi-weekly to executives. Success is vital for annual growth and market position.</p>
                </div>
            </div>
        </div>

        <div class="slide" id="slide8">
            <h2>Congratulations & Next Steps üéâ</h2>
            <h3>What You've Accomplished üèÜ</h3>
            <ul>
                <li>Integrated Salesforce with Google Gemini API for text summarization.</li>
                <li>Built a custom LWC for UI and interaction.</li>
                <li>Implemented Apex callouts using Named Credentials.</li>
                <li>Mastered LWC-Apex communication.</li>
            </ul>
            <h3>Potential Project Implementations & Enhancements üöÄ</h3>
            <ul>
                <li>Summarize Cases, Accounts, Emails, or Chatter.</li>
                <li>Batch summarization for multiple records.</li>
                <li>Custom prompts for different summary styles.</li>
                <li>Add sentiment analysis or keyword extraction.</li>
                <li>Option to save summaries back to records.</li>
            </ul>
            <h3>Further Reading & Resources üìö</h3>
            <ul>
                <li><a href="https://ai.google.dev/docs/gemini_api_overview" target="_blank">Google Gemini API Documentation</a></li>
                <li><a href="https://developer.salesforce.com/docs/" target="_blank">Salesforce Developer Guide</a></li>
                <li><a href="https://developer.salesforce.com/docs/component-library/documentation/en/lwc" target="_blank">LWC Dev Guide</a></li>
                <li>Trailhead: Apex Integration, LWC.</li>
            </ul>
            <p>Keep exploring, keep building, and happy coding!</p>
        </div>
    </div> <div class="navigation-buttons">
        <button id="prevBtn" onclick="changeSlide(-1)">‚ùÆ Previous</button>
        <button id="nextBtn" onclick="changeSlide(1)">Next ‚ùØ</button>
    </div>

    <script>
        // --- Slide Navigation Logic ---
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide');
        const totalSlides = slides.length;
        const prevButton = document.getElementById('prevBtn');
        const nextButton = document.getElementById('nextBtn');

        function showSlide(index) {
            if (index < 0 || index >= totalSlides) {
                console.error("Invalid slide index:", index);
                return;
            }
            slides.forEach((slideEl, i) => {
                slideEl.classList.remove('active');
                if (i === index) {
                    slideEl.classList.add('active');
                }
            });
            currentSlide = index;
            updateNavButtons();

            if (index === 6) { // Slide 7 (0-indexed for workflow animation)
                startWorkflowAnimation();
            }
        }

        function changeSlide(step) {
            let newSlideIndex = currentSlide + step;
            if (newSlideIndex >= 0 && newSlideIndex < totalSlides) {
                showSlide(newSlideIndex);
            }
        }
        
        function updateNavButtons() {
            if (prevButton) {
                prevButton.disabled = currentSlide === 0;
            }
            if (nextButton) {
                nextButton.disabled = currentSlide === totalSlides - 1;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            if (slides.length > 0) {
                showSlide(0);
            } else {
                console.error("No slides found. Navigation will not work.");
                if(prevButton) prevButton.disabled = true;
                if(nextButton) nextButton.disabled = true;
            }
            const toggleBtn = document.getElementById('toggleSummaryBtn');
            const summaryView = document.getElementById('summaryAfterView');
            if (toggleBtn && summaryView) {
                 if (summaryView.style.display === 'none' || summaryView.style.display === '') {
                    toggleBtn.textContent = 'Show AI Summary Example';
                } else {
                    toggleBtn.textContent = 'Show Original Text';
                }
            }
            basicSyntaxHighlight(); // Apply syntax highlighting after DOM is ready
        });

        // --- Slide 7: D3.js Workflow Animation ---
        function startWorkflowAnimation() {
            const svgContainer = d3.select("#workflowAnimation");
            svgContainer.selectAll("*").remove(); 

            const bounds = svgContainer.node().getBoundingClientRect();
            const width = bounds.width;
            const height = bounds.height;

            if (width <= 0 || height <= 0) {
                console.warn("D3 container has no dimensions. Skipping animation.");
                return;
            }
            
            const svg = svgContainer.append("svg")
                .attr("width", width)
                .attr("height", height)
                .attr("viewBox", `0 0 ${width} ${height}`)
                .style("overflow", "visible");

            const nodeRadius = Math.min(width, height) * 0.05;
            const fontSize = Math.min(width, height) * 0.025;

            const nodes = [
                { id: 1, name: "User Clicks Summarise", x: width * 0.2, y: height * 0.3 },
                { id: 2, name: "Apex Callout", x: width * 0.4, y: height * 0.3 },
                { id: 3, name: "SF Sends Request", x: width * 0.5, y: height * 0.15 },
                { id: 4, name: "Gemini API Processes", x: width * 0.7, y: height * 0.15 },
                { id: 5, name: "Gemini Responds", x: width * 0.5, y: height * 0.85 },
                { id: 6, name: "Apex Receives", x: width * 0.4, y: height * 0.7 },
                { id: 7, name: "Summary Displayed", x: width * 0.2, y: height * 0.7 }
            ];

            const links = [
                { source: nodes[0], target: nodes[1], label: "1. UI Event" },
                { source: nodes[1], target: nodes[2], label: "2. To SF Server" },
                { source: nodes[2], target: nodes[3], label: "3. To Gemini" },
                { source: nodes[3], target: nodes[4], label: "4. AI Response" },
                { source: nodes[4], target: nodes[5], label: "5. Back to SF" },
                { source: nodes[5], target: nodes[6], label: "6. Update UI" }
            ];
            
            svg.append("defs").append("marker")
                .attr("id", "arrow")
                .attr("viewBox", "0 -5 10 10")
                .attr("refX", nodeRadius * 0.7 + 5) 
                .attr("refY", 0)
                .attr("markerWidth", 6)
                .attr("markerHeight", 6)
                .attr("orient", "auto-start-reverse")
              .append("path")
                .attr("d", "M0,-5L10,0L0,5")
                .style("fill", "#555");

            const nodeElements = svg.selectAll("g.node")
                .data(nodes)
                .enter().append("g")
                .attr("class", "node")
                .attr("transform", d => `translate(${d.x},${d.y})`);

            nodeElements.append("circle")
                .attr("r", nodeRadius)
                .style("fill", "#00A1E0")
                .style("stroke", "#0070D2")
                .style("stroke-width", 2);

            nodeElements.append("text")
                .text(d => d.name)
                .attr("x", 0) 
                .attr("y", nodeRadius + fontSize * 1.2) 
                .style("font-size", `${fontSize}px`)
                .style("fill", "#333")
                .style("text-anchor", "middle");

            let animationDelay = 0;
            const stepDuration = 1000; 
            const highlightDuration = 500;

            links.forEach((link, i) => {
                const path = svg.append("line")
                    .attr("x1", link.source.x).attr("y1", link.source.y)
                    .attr("x2", link.source.x).attr("y2", link.source.y)
                    .attr("stroke", "#aaa").attr("stroke-width", 2)
                    .attr("marker-end", "url(#arrow)");
                
                const label = svg.append("text")
                    .text(link.label)
                    .attr("x", (link.source.x + link.target.x) / 2)
                    .attr("y", (link.source.y + link.target.y) / 2 - 5)
                    .style("font-size", `${fontSize * 0.8}px`).style("fill", "#555")
                    .style("text-anchor", "middle").style("opacity", 0);

                d3.select(nodeElements.nodes()[i]).select("circle").transition()
                    .delay(animationDelay).duration(highlightDuration).style("fill", "orange");
                animationDelay += highlightDuration;

                path.transition().delay(animationDelay).duration(stepDuration)
                    .attr("x2", link.target.x).attr("y2", link.target.y);

                label.transition().delay(animationDelay + stepDuration / 2).duration(highlightDuration)
                    .style("opacity", 1);
                animationDelay += stepDuration;

                d3.select(nodeElements.nodes()[i]).select("circle").transition()
                    .delay(animationDelay).duration(highlightDuration).style("fill", "#5cb85c");
            });
            
            if (nodes.length > 0) {
                 d3.select(nodeElements.nodes()[nodes.length-1]).select("circle").transition()
                    .delay(animationDelay).duration(highlightDuration).style("fill", "#5cb85c");
            }
        }
        
        function toggleSummaryView() {
            const originalView = document.getElementById('originalTextView');
            const summaryView = document.getElementById('summaryAfterView');
            const button = document.getElementById('toggleSummaryBtn');

            if (summaryView && originalView && button) {
                if (summaryView.style.display === 'none' || summaryView.style.display === '') {
                    originalView.style.display = 'none';
                    summaryView.style.display = 'block';
                    button.textContent = 'Show Original Text';
                } else {
                    originalView.style.display = 'block';
                    summaryView.style.display = 'none';
                    button.textContent = 'Show AI Summary Example';
                }
            }
        }

        function basicSyntaxHighlight() {
            document.querySelectorAll('pre code').forEach(block => {
                let html = block.textContent || ""; 
                
                html = html.replace(/(\/\*[\s\S]*?\*\/|\/\/.*)/g, '<span class="token comment">$&</span>');
                html = html.replace(/('.*?'|".*?")/g, '<span class="token string">$&</span>');
                html = html.replace(/\b(public|private|static|void|String|Id|Map|List|if|else|for|while|try|catch|finally|return|new|with sharing|class|extends|implements|integer|boolean|true|false|null|this|super|@AuraEnabled|@api|@wire|@track|@TestVisible|@future|@InvocableMethod|@InvocableVariable|@IsTest)\b/g, '<span class="token keyword">$&</span>');
                html = html.replace(/\b(import|export|default|const|let|var|async|await|function|class|extends|constructor|get|set|=>|yield|from|of|this|super|true|false|null|undefined)\b/g, '<span class="token keyword">$&</span>');
                html = html.replace(/(@[A-Za-z_][A-Za-z0-9_]*(?:\s*\([\s\S]*?\))?)/g, '<span class="token annotation">$&</span>');
                
                if (block.classList.contains('language-html') || block.classList.contains('language-xml')) {
                    html = html.replace(/(&lt;\/?)([a-zA-Z0-9-]+)/g, '$1<span class="token tag">$2</span>');
                    html = html.replace(/([a-zA-Z0-9-]+)=(".*?"|'.*?')/g, '<span class="token attr-name">$1</span>=<span class="token attr-value">$2</span>');
                }
                block.innerHTML = html;
            });
        }
    </script>
</body>
</html>
